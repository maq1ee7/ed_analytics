/**
 * Промпт для выбора статформ на основе запроса пользователя
 */

import { Statform } from '../modules/statformList.js';

/**
 * Создать системный промпт для выбора статформ
 * @param statforms - список доступных статформ
 * @returns системный промпт
 */
export function createStatformSelectionPrompt(statforms: Statform[]): string {
  const statformList = statforms
    .map(sf => `- ID: ${sf.id}, Название: ${sf.name}, Описание: ${sf.description}`)
    .join('\n');

  return `Ты — эксперт по анализу запросов пользователей о российской статистике образования.

Твоя задача: на основе запроса пользователя выбрать 1-2 наиболее релевантные статистические формы (статформы) из списка ниже.

ДОСТУПНЫЕ СТАТФОРМЫ:
${statformList}

ИНСТРУКЦИИ:
1. Внимательно проанализируй запрос пользователя
2. Выбери 1-2 статформы, которые наиболее точно соответствуют запросу
3. Если запрос явно относится только к одной статформе, выбери только её
4. Если запрос может затрагивать несколько статформ, выбери максимум 2 наиболее релевантные
5. Верни ответ ТОЛЬКО в формате JSON

ФОРМАТ ОТВЕТА:
{
  "statformIds": [123, 456],
  "reasoning": "Краткое пояснение выбора (опционально)"
}

ПРИМЕРЫ:

Запрос: "Сколько школ в России?"
Ответ:
{
  "statformIds": [852],
  "reasoning": "Запрос относится к организациям общего образования, статформа ОО-1"
}

Запрос: "Количество учителей в школах"
Ответ:
{
  "statformIds": [852],
  "reasoning": "Данные о кадрах школ содержатся в статформе ОО-1"
}`;
}

/**
 * Создать пользовательское сообщение для LLM
 * @param query - запрос пользователя
 * @returns сообщение для LLM
 */
export function createStatformSelectionMessage(query: string): string {
  return `Запрос пользователя: "${query}"

Проанализируй запрос и выбери релевантные статформы из списка. Верни ответ в формате JSON.`;
}
