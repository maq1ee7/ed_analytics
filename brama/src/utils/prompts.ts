/**
 * Промпты для LLM запросов (3 шага обработки запроса)
 */

export const STEP1_PROMPT = `Ты — ассистент для работы со статистическими данными образовательных организаций РФ.

У нас есть 2 статистические формы:
- OO_1: Общее образование (сведения о численности, классах, обучающихся, учителях, выпускниках)
- OO_2: Инфраструктура и ресурсы (здания, компьютеры, библиотеки, финансы, площади)

И 4 вида сведений:
- гоу_город: Государственные/муниципальные организации в городских поселениях
- гоу_село: Государственные/муниципальные организации в сельских поселениях
- ноу_город: Негосударственные организации в городских поселениях
- ноу_село: Негосударственные организации в сельских поселениях

Пользователь задал запрос: "{query}"

Определи:
1. Какая форма нужна (OO_1 или OO_2)?
2. Какой вид сведений (гоу_город, гоу_село, ноу_город, ноу_село)?

**Примеры:**
- "Покажи количество школ в городах" → {{"form_code": "OO_1", "view_type": "гоу_город"}}
- "Сколько учеников окончили 9 класс в сельских негосударственных школах?" → {{"form_code": "OO_1", "view_type": "ноу_село"}}
- "Какая площадь школьных зданий?" → {{"form_code": "OO_2", "view_type": "гоу_город"}}

**Важно:**
- Если не указано город/село - по умолчанию "гоу_город"
- Если не указано государственные/негосударственные - по умолчанию "гоу_"
- Вопросы про учеников, классы, учителей, выпускников → OO_1
- Вопросы про здания, компьютеры, библиотеки, финансы → OO_2

Верни ТОЛЬКО JSON в формате:
{{
  "form_code": "OO_1" или "OO_2",
  "view_type": "гоу_город" | "гоу_село" | "ноу_город" | "ноу_село"
}}`;

export const STEP2_PROMPT = `Ты выбираешь номер таблицы (раздела) из списка для ответа на запрос пользователя.

Запрос пользователя: "{query}"
Форма: {formCode}

**Список доступных таблиц:**
{tableList}

Выбери НАИБОЛЕЕ ПОДХОДЯЩИЙ раздел для ответа на запрос пользователя.

**Примеры:**
- "Сколько учеников окончили 9 класс?" → {{"section": "2.5.2"}}  (Сведения об окончивших классы)
- "Количество классов" → {{"section": "2.1.1"}}  (Число всех классов)
- "Сведения о зданиях школ" → {{"section": "1.1"}}  (Характеристика здания)
- "Сколько компьютеров?" → {{"section": "2.1"}}  (Количество персональных компьютеров)

**Правила выбора:**
- Ищи наиболее специфичный раздел (например, для "окончили класс" выбирай 2.5.x, а не общий раздел 2)
- Если несколько подходящих - выбирай с наиболее точным названием

Верни ТОЛЬКО JSON:
{{
  "section": "номер раздела"
}}`;

export const STEP3_PROMPT = `Ты определяешь координаты ячейки (номер строки и колонки) в таблице для ответа на запрос.

Запрос пользователя: "{query}"
Форма: {formCode}
Раздел: {section}

**Схема таблицы:**
{tableSchema}

Изучи схему таблицы выше и определи:
1. **col_index** - номер колонки (начиная с 1)
2. **row_index** - номер строки данных (начиная с 1, НЕ считая заголовок с id=1)

**Как читать схему:**
- В разделе "Первые 2 колонки" показаны все строки: col_1 обычно содержит номер строки, col_2 - название показателя
- В разделе "Заголовки и первые 2 строки данных" показаны все колонки в CSV формате
- Первая строка в CSV - это заголовки колонок
- row_index=1 означает ПЕРВУЮ строку данных (вторая строка в CSV, после заголовков)

**Примеры:**
- Запрос "Всего обучающихся" + в col_2 строка №1 = "Всего обучающихся" + нужна колонка col_5
  → {{"col_index": 5, "row_index": 1}}

- Запрос "Численность экстернов" + в col_2 строка №6 = "Численность экстернов" + нужна колонка col_3
  → {{"col_index": 3, "row_index": 6}}

**Правила:**
- Ищи нужный показатель в col_2 (название показателей)
- Определи его номер строки (это будет row_index)
- Выбери подходящую колонку по запросу (обычно col_3 или col_4 для итоговых данных)
- Если запрос не указывает конкретную колонку - выбирай col_3 (часто это "всего")

Верни ТОЛЬКО JSON:
{{
  "col_index": число,
  "row_index": число
}}`;

/**
 * Форматирует промпт шага 1
 */
export function formatStep1Prompt(query: string): string {
  return STEP1_PROMPT.replace('{query}', query);
}

/**
 * Форматирует промпт шага 2
 */
export function formatStep2Prompt(query: string, formCode: string, tableList: string): string {
  return STEP2_PROMPT
    .replace('{query}', query)
    .replace('{formCode}', formCode)
    .replace('{tableList}', tableList);
}

/**
 * Форматирует промпт шага 3
 */
export function formatStep3Prompt(
  query: string,
  formCode: string,
  section: string,
  tableSchema: string
): string {
  return STEP3_PROMPT
    .replace('{query}', query)
    .replace('{formCode}', formCode)
    .replace('{section}', section)
    .replace('{tableSchema}', tableSchema);
}






