# Telegram Bot ะดะปั ED Analytics

Telegram ะฑะพั ะดะปั ะพัะฟัะฐะฒะบะธ ัััะปะพะบ ะฝะฐ ะณะพัะพะฒัะต ะดะฐัะฑะพัะดั ะฟะพะปัะทะพะฒะฐัะตะปัะผ.

## ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั

1. ะัะธะฝะธะผะฐะตั ัะตะบััะพะฒัะต ะฒะพะฟัะพัั ะพั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
2. ะัะฟัะฐะฒะปัะตั ะทะฐะฟัะพัั ะฝะฐ Backend ะดะปั ะพะฑัะฐะฑะพัะบะธ
3. ะะพะปััะฐะตั ัะฒะตะดะพะผะปะตะฝะธั ะธะท Bull queue ะบะพะณะดะฐ ะดะฐัะฑะพัะด ะณะพัะพะฒ
4. ะัะฟัะฐะฒะปัะตั ัััะปะบะธ ะฝะฐ ะณะพัะพะฒัะต ะดะฐัะฑะพัะดั ะฟะพะปัะทะพะฒะฐัะตะปัะผ

## ะััะธัะตะบัััะฐ

```
User โ Telegram Bot โ Backend API โ Brama
                         โ
                    Bull Queue (Redis)
                         โ
                    Telegram Bot โ User (ัััะปะบะฐ)
```

## Whitelist ะฟะพะปัะทะพะฒะฐัะตะปะตะน

**TODO: ะะตัะตะฝะตััะธ whitelist ะฒ ะะ ะธะปะธ ะฒะฝะตัะฝะธะน ะบะพะฝัะธะณ ะฟะตัะตะด ะฟัะพะดะฐะบัะตะฝะพะผ!**

ะกะตะนัะฐั ัะฟะธัะพะบ ัะฐะทัะตัะตะฝะฝัั ะฟะพะปัะทะพะฒะฐัะตะปะตะน ััะฐะฝะธััั ะฒ `src/config.ts`:
- @v_karlov
- @kochemirov

## ะะตะทะพะฟะฐัะฝะพััั

**TODO: ะะทะผะตะฝะธัั ัะปะตะดัััะธะต ะฟะตัะตะผะตะฝะฝัะต ะฟะตัะตะด ะฟัะพะดะฐะบัะตะฝะพะผ:**

1. `TELEGRAM_BOT_TOKEN` - ัะพะบะตะฝ ะฑะพัะฐ (ะฒ docker-compose.yml ะธ config.ts)
2. `TELEGRAM_BOT_API_KEY` - API ะบะปัั ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ ั Backend (ะฒ docker-compose.yml ะธ config.ts)

## ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะพ ัะผะพะปัะฐะฝะธั |
|------------|----------|--------------|
| `TELEGRAM_BOT_TOKEN` | Telegram Bot API ัะพะบะตะฝ | - |
| `TELEGRAM_BOT_API_KEY` | API ะบะปัั ะดะปั Backend | - |
| `BACKEND_URL` | URL Backend API | `http://backend:5000` |
| `REDIS_HOST` | Redis ัะพัั | `localhost` |
| `REDIS_PORT` | Redis ะฟะพัั | `6379` |
| `DASHBOARD_BASE_URL` | ะะฐะทะพะฒัะน URL ะดะปั ะดะฐัะฑะพัะดะพะฒ | `http://130.193.46.4` |

## ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

### ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
npm install
```

### ะะฐะฟััะบ ะฒ dev ัะตะถะธะผะต

```bash
npm run dev
```

### ะกะฑะพัะบะฐ

```bash
npm run build
npm start
```

## Docker

ะะพั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฟััะบะฐะตััั ะฒะผะตััะต ัะพ ะฒัะตะผ ััะตะบะพะผ ัะตัะตะท docker-compose:

```bash
docker-compose up -d
```

ะะปะธ ัะพะปัะบะพ ะฑะพั:

```bash
docker-compose up telegram-bot
```

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

1. ะะฐะนะดะธัะต ะฑะพัะฐ: [@brama_dev_bot](https://t.me/brama_dev_bot)
2. ะัะฟัะฐะฒััะต ัะตะบััะพะฒัะน ะฒะพะฟัะพั
3. ะะพะปััะธัะต ะพัะฒะตั "โณ ะะฑัะฐะฑะฐััะฒะฐั ะทะฐะฟัะพั..."
4. ะงะตัะตะท ะฝะตะบะพัะพัะพะต ะฒัะตะผั ะฟะพะปััะธัะต ัััะปะบั ะฝะฐ ะดะฐัะฑะพัะด: "โ ะะฐัะฑะพัะด ะณะพัะพะฒ! ๐ [ัััะปะบะฐ]"

### ะขะฐะนะผะฐััั ะธ ะพะณัะฐะฝะธัะตะฝะธั

- **ะขะฐะนะผะฐัั ะพะฑัะฐะฑะพัะบะธ**: 1 ะผะธะฝััะฐ (ะฟะพัะปะต ัะตะณะพ ะฑะพั ัะพะพะฑัะธั ะพ ะฟัะตะฒััะตะฝะธะธ ะฒัะตะผะตะฝะธ)
- **Concurrent ะทะฐะฟัะพัั**: ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะพัะฟัะฐะฒะปััั ะฝะตัะบะพะปัะบะพ ะทะฐะฟัะพัะพะฒ ะฟะฐัะฐะปะปะตะปัะฝะพ
- **Retry**: Bull queue ะดะตะปะฐะตั 3 ะฟะพะฟััะบะธ ะพัะฟัะฐะฒะบะธ ัะฒะตะดะพะผะปะตะฝะธั ั ัะบัะฟะพะฝะตะฝัะธะฐะปัะฝะพะน ะทะฐะดะตัะถะบะพะน (2s, 4s, 8s)

## ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ

- ะัะปะธ Backend ะฝะตะดะพัััะฟะตะฝ โ "โ ะกะตัะฒะธั ะพะฑัะฐะฑะพัะบะธ ะฒัะตะผะตะฝะฝะพ ะฝะตะดะพัััะฟะตะฝ"
- ะัะปะธ Brama ะฒะตัะฝัะปะฐ ะพัะธะฑะบั โ "โ ะัะพะธะทะพัะปะฐ ะพัะธะฑะบะฐ ะฟัะธ ะพะฑัะฐะฑะพัะบะต ะทะฐะฟัะพัะฐ"
- ะัะปะธ ัะฐะนะผะฐัั (>1 ะผะธะฝััั) โ "โฑ ะัะตะผั ะพะถะธะดะฐะฝะธั ะธััะตะบะปะพ"

## ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
telegram-bot/
โโโ src/
โ   โโโ bot.ts                  # ะะปะฐะฒะฝัะน ัะฐะนะป ะฑะพัะฐ
โ   โโโ config.ts               # ะะพะฝัะธะณััะฐัะธั (ัะพะบะตะฝั, whitelist)
โ   โโโ services/
โ   โ   โโโ apiService.ts       # ะะทะฐะธะผะพะดะตะนััะฒะธะต ั Backend API
โ   โ   โโโ redisService.ts     # Bull queue ะดะปั ัะฒะตะดะพะผะปะตะฝะธะน
โ   โโโ types/
โ       โโโ index.ts            # TypeScript ัะธะฟั
โโโ Dockerfile
โโโ package.json
โโโ tsconfig.json
โโโ README.md
```

## ะะพะณะธ

ะัะต ะพะฟะตัะฐัะธะธ ะปะพะณะธัััััั ั ะฟัะตัะธะบัะฐะผะธ:
- `[TelegramBot]` - ะพัะฝะพะฒะฝัะต ะพะฟะตัะฐัะธะธ ะฑะพัะฐ
- `[ApiService]` - ะฒัะทะพะฒั Backend API
- `[RedisService]` - ะพะฑัะฐะฑะพัะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน ะธะท ะพัะตัะตะดะธ

## Production Checklist

- [ ] ะะทะผะตะฝะธัั `TELEGRAM_BOT_TOKEN` ะฝะฐ ะฟัะพะดะฐะบัะตะฝ ัะพะบะตะฝ
- [ ] ะะทะผะตะฝะธัั `TELEGRAM_BOT_API_KEY` ะฝะฐ ะฝะฐะดะตะถะฝัะน ะบะปัั
- [ ] ะะตัะตะฝะตััะธ whitelist ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฒ ะะ ะธะปะธ ะบะพะฝัะธะณ
- [ ] ะะฐัััะพะธัั ะผะพะฝะธัะพัะธะฝะณ ะธ ะฐะปะตััั
- [ ] ะะพะฑะฐะฒะธัั rate limiting (ะตัะปะธ ะฝัะถะฝะพ)

